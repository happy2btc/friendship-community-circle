<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Affirm Your Values</title>
    <script type="module" src="/lib/supabase.js"></script>
    <style>
        body { font-family: Georgia, serif; background-color: #f9f6f1; color: #3b2f2f; margin: 40px; text-align: center; }
        .container { max-width: 700px; margin: 0 auto; background-color: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        h1 { color: #6b4f1d; }
        ul { list-style-type: none; padding: 0; text-align: left; display: inline-block; }
        li { margin-bottom: 1rem; font-size: 1.1em; }
        button { background-color: #2e8b57; color: #fff; padding: 15px 30px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 30px; font-size: 1.2em; }
        button:disabled { background-color: #ccc; }
        #status { margin-top: 1rem; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Our Community Values</h1>
        <p>By entering, you affirm your commitment to these principles:</p>
<ul>
    <li>üåø <strong>Honesty:</strong> We communicate openly and truthfully.</li>
    <li>ü§ù <strong>Respect:</strong> We honor each other's perspectives and boundaries.</li>
    <li>‚ú® <strong>Integrity:</strong> We act in alignment with our values, even when no one is watching.</li>
    <li>üå± <strong>Growth:</strong> We are committed to personal and collective learning.</li>
    <li>‚ù§Ô∏è <strong>Compassion:</strong> We approach ourselves and others with kindness and understanding.</li>
</ul>
        <button id="affirm-button">I Affirm These Values</button>
        <p id="status"></p>
    </div>

    <script type="module">
        import { supabase } from '/lib/supabase.js';

        const affirmButton = document.getElementById('affirm-button');
        const statusEl = document.getElementById('status');
        let currentUser;

        async function checkUser() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) {
                // If no user is logged in, send them back to the start
                window.location.href = 'index.html';
            }
            currentUser = user;
        }

        affirmButton.addEventListener('click', async () => {
            affirmButton.disabled = true;
            statusEl.textContent = 'Recording your affirmation...';

            // We'll save the current date as both affirmation_text and affirmation_date
            const affirmationValue = new Date().toISOString();
            const { error } = await supabase
                .from('profiles')
                .update({ affirmation_text: affirmationValue, affirmation_date: affirmationValue })
                .eq('id', currentUser.id);

            if (error) {
                statusEl.textContent = `Error: ${error.message}`;
                statusEl.style.color = 'red';
                affirmButton.disabled = false;
            } else {
                // Success! Redirect to the welcome page.
                window.location.href = 'welcome.html';
            }
        });

        // Run the user check as soon as the page loads
        checkUser();
    </script>
</body>
</html>