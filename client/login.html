<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sign In</title>
  <script type="module" src="/lib/supabase.js"></script>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; padding: 2rem; }
    .container { max-width: 400px; margin: auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #eee; padding: 2em; }
    h1 { text-align: center; }
    input, button { width: 100%; margin-bottom: 1em; padding: 0.7em; border-radius: 6px; border: 1px solid #ccc; }
    button { background: #4a7c59; color: #fff; font-weight: bold; border: none; }
    button:hover { background: #388e3c; }
    .error { color: #a94442; margin-bottom: 1em; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Sign In</h1>
    <div id="error" class="error"></div>
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Password" required />
    <button id="login-btn">Sign In</button>
  </div>
  <script type="module">
    import { supabase } from '/lib/supabase.js';
    const loginBtn = document.getElementById('login-btn');
    const errorDiv = document.getElementById('error');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');

    // Get redirect param from URL
    const params = new URLSearchParams(window.location.search);
    const redirectUrl = params.get('redirect');

    loginBtn.addEventListener('click', async () => {
      errorDiv.textContent = '';
      const email = emailInput.value.trim();
      const password = passwordInput.value;
      if (!email || !password) {
        errorDiv.textContent = 'Please enter both email and password.';
        return;
      }
      const { error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) {
        errorDiv.textContent = error.message;
      } else {
        // Redirect after login
        window.location.href = redirectUrl || 'home.html';
      }
    });
  </script>
</body>
</html>
