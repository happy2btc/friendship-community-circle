import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as i}from"./supabase-vDZkBp_j.js";const m=document.getElementById("uploadForm"),n=document.getElementById("videoList"),a=document.getElementById("uploadStatus");let d={};async function g(){const{data:e}=await i.from("profiles").select("id, full_name");d={},(e||[]).forEach(t=>{d[t.id]=t.full_name})}async function v(){try{const{data:e,error:t}=await i.storage.from("member-videos").list();t?(console.error("Storage check error:",t),alert("Storage check failed: "+t.message)):(console.log("Files in member-videos bucket:",e),alert(`Found ${e.length} files in storage bucket:
${e.map(r=>r.name).join(`
`)}`))}catch(e){console.error("Storage check failed:",e),alert("Storage check failed: "+e.message)}}window.checkStorageBucket=v;async function f(){const{data:e,error:t}=await i.from("member_video").select("id, user_id, video_url, caption, created_at").order("created_at",{ascending:!1}).limit(50);if(t){n.innerHTML="<p>Error loading videos.</p>",console.error("Error fetching videos:",t);return}if(console.log("Fetched videos:",e),!e||e.length===0){n.innerHTML="<p>No videos posted yet. Be the first to share a video!</p>";return}n.innerHTML=e.map(o=>`
        <div class="video-item">
          <div class="video-meta">Posted by <b>${d[o.user_id]||o.user_id}</b> on ${new Date(o.created_at).toLocaleString()}</div>
          <video src="${o.video_url}" controls preload="metadata" style="max-width:100%;border-radius:8px;" onerror="handleVideoError(this, '${o.video_url}')" onloadstart="console.log('Video started loading:', '${o.video_url}')"></video>
          ${o.caption?`<div class="video-meta">${o.caption}</div>`:""}
          <div class="video-debug" style="font-size:0.8em;color:#999;margin-top:4px;">URL: ${o.video_url.substring(0,50)}...</div>
        </div>
      `).join("");const r=document.createElement("div");r.style.textAlign="center",r.style.marginBottom="1em",r.style.color="#666",r.textContent=`Showing ${e.length} video${e.length!==1?"s":""}`,n.insertBefore(r,n.firstChild)}m.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("videoFile").files[0],r=document.getElementById("caption").value;if(!t)return;a.textContent="Uploading...";const{data:{user:o}}=await i.auth.getUser();if(!o){a.textContent="You must be logged in.";return}const l=`${o.id}/${Date.now()}_${t.name}`,{data:h,error:c}=await i.storage.from("member-videos").upload(l,t,{cacheControl:"3600",upsert:!1});if(c){a.textContent="Upload failed: "+c.message;return}const{data:p}=i.storage.from("member-videos").getPublicUrl(l),s=p?.publicUrl;if(console.log("Generated public URL:",s),!s){a.textContent="Could not get public URL for uploaded video.";return}const{error:u}=await i.from("member_video").insert([{user_id:o.id,video_url:s,caption:r}]);if(u){a.textContent="Database error: "+u.message;return}a.textContent="Video posted!",m.reset(),await g(),f()});await g();f();
