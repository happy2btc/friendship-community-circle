import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as i}from"./supabase-vDZkBp_j.js";async function u(){const{data:t}=await i.auth.getUser();return t?.user}async function c(t){const{data:r}=await i.from("profiles").select("full_name").eq("id",t).single();return r?.full_name||"Unknown"}async function m(t){const r=`${crypto.randomUUID()}_${t.name}`,{data:e,error:a}=await i.storage.from("skill_videos").upload(r,t);if(a)throw a;const{publicUrl:l}=i.storage.from("skill_videos").getPublicUrl(r);return l}document.getElementById("video_mode").addEventListener("change",t=>{const r=t.target.value;document.getElementById("video-url-wrapper").style.display=r==="url"?"block":"none",document.getElementById("video-upload-wrapper").style.display=r==="upload"?"block":"none",r==="url"?document.getElementById("video").value="":document.getElementById("video_url").value=""});document.getElementById("skill-share-form").onsubmit=async t=>{t.preventDefault();const r=await u();if(!r){alert("You must be signed in to share a skill.");return}const e=document.getElementById("skill_name").value.trim(),a=document.getElementById("skill_description").value.trim(),l=document.getElementById("video_mode").value;let s="";if(!e){alert("Please enter a skill name.");return}try{if(l==="url"){const n=document.getElementById("video_url").value.trim();if(!n){alert("Please paste a video URL.");return}if(!/^https?:\/\//i.test(n)){alert("Please enter a valid URL (starting with http:// or https://)");return}s=n}else{const n=document.getElementById("video").files[0];if(!n){alert("Please select a video file to upload.");return}s=await m(n)}}catch(n){alert("Video handling failed: "+(n.message||n));return}const{error:o}=await i.from("skill_shares").insert([{skill_name:e,skill_description:a,presenter_id:r.id,video_url:s}]);if(o){alert("Failed to share skill: "+o.message);return}document.getElementById("skill-share-form").reset(),document.getElementById("video_mode").value="url",document.getElementById("video-url-wrapper").style.display="block",document.getElementById("video-upload-wrapper").style.display="none",d()};async function d(){const{data:t}=await i.from("skill_shares").select("id, skill_name, skill_description, presenter_id, video_url, created_at").order("created_at",{ascending:!1}),r=document.getElementById("skill-list");if(!t||t.length===0){r.innerHTML="<em>No skills shared yet.</em>";return}r.innerHTML=await Promise.all(t.map(async e=>{const a=await c(e.presenter_id);return`
          <div class="skill-card">
            <div class="skill-title">${e.skill_name}</div>
            <div>${e.skill_description||""}</div>
            <div>
              <span class="skill-presenter">${a}</span>
              <span class="skill-date">${new Date(e.created_at).toLocaleString()}</span>
            </div>
            ${e.video_url?e.video_url.includes("youtube.com")||e.video_url.includes("youtu.be")?`
              <div style="margin-top:0.5em;"><iframe width="560" height="315" src="https://www.youtube.com/embed/${(function(){try{const l=new URL(e.video_url);if(l.hostname.includes("youtu.be"))return l.pathname.slice(1);if(l.hostname.includes("youtube.com"))return l.searchParams.get("v")}catch{}return""})()}" frameborder="0" allowfullscreen></iframe></div>
            `:`<video controls src="${e.video_url}"></video>`:""}
          </div>
        `})).then(e=>e.join(""))}d();
