import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as a}from"./supabase-vDZkBp_j.js";async function d(){if(!s||!i(s))return;const{data:e}=await a.from("profiles").select("full_name, bio").eq("id",s).single(),{data:o}=await a.from("member_struggles").select("project, struggle").eq("profile_id",s);let t="";if(e&&(t+=`<strong>${e.full_name||"Unnamed Member"}</strong><br>`,e.bio&&(t+=`<div style="color:#888;">${e.bio}</div>`)),o&&o.length>0){t+='<ul style="margin:0.5em 0 0 0;padding:0;list-style:none;">';for(const n of o)t+=`<li><span style="color:#2e8b57;font-weight:bold;">Project:</span> ${n.project||""}<br><span style="color:#6b4f1d;">Struggle:</span> ${n.struggle||""}</li>`;t+="</ul>"}document.getElementById("member-info").innerHTML=t}const c=new URLSearchParams(window.location.search),s=c.get("to");function i(e){return/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(e)}if(!s||!i(s))document.getElementById("messages").innerHTML='<p style="color:red;">No valid member selected. Please use the "Message this member" button from the projects page.</p>',document.getElementById("chat-input").disabled=!0,document.getElementById("send-btn").disabled=!0,document.getElementById("member-info").innerHTML="";else{let e=null;a.auth.getUser().then(({data:t})=>{e=t?.user?.id,o(),d()});async function o(){if(!e||!s)return;const{data:t,error:n}=await a.from("messages").select("*").or(`from.eq.${e},from.eq.${s}`).or(`to.eq.${e},to.eq.${s}`).order("created_at",{ascending:!0});if(n){document.getElementById("messages").innerHTML=`<p style="color:red;">Error loading messages: ${n.message}</p>`;return}const r=document.getElementById("messages");r.innerHTML="";for(const m of t){const l=document.createElement("div");l.className="message "+(m.from===e?"me":"them"),l.textContent=m.body,r.appendChild(l)}r.scrollTop=r.scrollHeight}document.getElementById("send-btn").onclick=async()=>{const t=document.getElementById("chat-input"),n=t.value.trim();if(!n||!e||!s)return;const{error:r}=await a.from("messages").insert([{from:e,to:s,body:n}]);r||(t.value="",o())}}
