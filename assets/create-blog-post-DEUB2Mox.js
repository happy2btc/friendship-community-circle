import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as n}from"./supabase-vDZkBp_j.js";console.log("Page URL:",window.location.href);const y=new URLSearchParams(window.location.search),e=y.get("circle_id");console.log("Parsed circle_id:",e);const c=document.getElementById("blog-form"),t=document.getElementById("status"),g=document.getElementById("back-to-circle");e&&(g.href=`circle.html?id=${e}`,g.style.display="inline-block");c.addEventListener("submit",async f=>{f.preventDefault();const a=c.querySelector("button");a.disabled=!0,t.textContent="Submitting...";const{data:{user:l}}=await n.auth.getUser();if(!l){t.textContent="You must be logged in to create a post.",a.disabled=!1;return}const b=document.getElementById("title").value,w=document.getElementById("content").value,s=document.getElementById("image").files[0];let d=null,m=null;try{if(s){const r=`blog/${e}/${l.id}/${Date.now()}_${s.name}`,{error:i}=await n.storage.from("blog-images").upload(r,s);if(i)throw new Error(`Image upload failed: ${i.message}`);d=r}const o=document.getElementById("video").files[0];if(o){const r=`blog/${e}/${l.id}/${Date.now()}_${o.name}`,{error:i}=await n.storage.from("blog-videos").upload(r,o);if(i)throw new Error(`Video upload failed: ${i.message}`);m=r}const{error:u}=await n.from("blog_posts").insert({circle_id:e,user_id:l.id,title:b,content:w,image_url:d,video_url:m});if(u)throw new Error(`Database insert failed: ${u.message}`);t.textContent="Post created successfully!",t.style.color="green",c.reset(),setTimeout(()=>{e&&(window.location.href=`circle.html?id=${e}`)},1500)}catch(o){t.textContent=`Error: ${o.message}`,t.style.color="red"}finally{a.disabled=!1}});
