import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as i}from"./supabase-vDZkBp_j.js";const G={suggest:"<a href='suggest.html' class='menu-button' style='background:#fff3cd;color:#654;'>Make a Suggestion</a>",discuss:"<a href='discussions.html' class='menu-button' style='background:#fff3cd;color:#654;'>View Current Discussions</a>",agreements:"<a href='agreements.html' class='menu-button' style='background:#fff3cd;color:#654;'>Proposed Agreements & Voting</a><a href='completed-agreements.html' class='menu-button' style='background:#fff3cd;color:#654;'>Completed Agreements</a><a href='agreements-voting.html' class='menu-button' style='background:#fff3cd;color:#654;'>Vote on Agreements</a>"},B=document.querySelectorAll(".sugg-tab-btn"),Y=document.getElementById("sugg-tab-content");function j(t){B.forEach(o=>o.style.background=o.dataset.tab===t?"#fffbe6":o.dataset.tab==="suggest"?"#ffe082":o.dataset.tab==="discuss"?"#b3c6e6":"#e6d6f7"),Y.innerHTML=G[t]}B.forEach(t=>t.addEventListener("click",()=>j(t.dataset.tab)));j("suggest");const F={submit:"<a href='contribute.html' class='menu-button' style='background:#d2f7e6;color:#234;'>Submit Your Project</a>",view:"<a href='view-proj-strug.html' class='menu-button' style='background:#d2f7e6;color:#234;'>View Personal Projects - Struggles</a>",groupskill:`<a href='group-projects.html' class='menu-button' style='background:#d2f7e6;color:#234;'>Group Projects</a><a href='skill-shares.html' class='menu-button' style='background:#d2f7e6;color:#234;'>Skill Shares</a><a href="writer's-wall.html" class='menu-button' style='background:#d2f7e6;color:#234;'>Writer's Wall</a>`},D=document.querySelectorAll(".proj-tab-btn"),J=document.getElementById("proj-tab-content");function N(t){D.forEach(o=>o.style.background=o.dataset.tab===t?"#eafbf4":o.dataset.tab==="submit"?"#ffe082":o.dataset.tab==="view"?"#b3c6e6":"#e6d6f7"),J.innerHTML=F[t]}D.forEach(t=>t.addEventListener("click",()=>N(t.dataset.tab)));N("submit");const Z={create:"<a href='create-circle.html' class='menu-button' style='background:#f7d6e6;color:#543;'>Create a New Circle</a>",manage:"<a href='circle-list.html' class='menu-button' style='background:#f7d6e6;color:#543;'>Manage Circles</a>",special:"<a href='circle.html?id=1d9493e2-b9b0-48f4-b12f-6411939809e9' class='menu-button' style='background:#f7d6e6;color:#543;'>Coven Community Network</a><a href='circle.html?id=5516d022-5354-409d-9fcc-cc151df649b3' class='menu-button' style='background:#f7d6e6;color:#543;'>Universal Basic Income Circle</a>"},S=document.querySelectorAll(".circle-tab-btn"),K=document.getElementById("circle-tab-content");function q(t){S.forEach(o=>o.style.background=o.dataset.tab===t?"#fbeaf4":o.dataset.tab==="create"?"#ffe082":o.dataset.tab==="manage"?"#b3c6e6":"#e6d6f7"),K.innerHTML=Z[t]}S.forEach(t=>t.addEventListener("click",()=>q(t.dataset.tab)));q("create");async function Q(){if(console.log("Notification button clicked"),!("Notification"in window)){alert("This browser does not support desktop notification"),console.log("Notification API not supported");return}let t=Notification.permission;if(console.log("Current notification permission:",t),t==="default")try{t=await Notification.requestPermission(),console.log("Permission after request:",t)}catch(o){alert("Error requesting notification permission: "+o),console.error("Error requesting permission:",o);return}t==="granted"?(alert("Permission granted! Showing test notification."),console.log("Permission granted, showing notification"),new Notification("ðŸ”” Friendship Community Circle",{body:"This is a test notification! You will see real notifications here soon.",icon:"/default-avatar.png"})):(alert("Notifications are blocked or denied. Please enable them in your browser settings."),console.log("Permission not granted:",t))}const I=document.createElement("button");I.textContent="Enable Desktop Notifications";I.style="margin: 1em auto; display: block; background: #2196f3; color: #fff; border: none; border-radius: 6px; padding: 10px 18px; font-size: 1em; font-weight: bold; cursor: pointer;";I.onclick=Q;document.body.insertBefore(I,document.body.firstChild.nextSibling);const H=document.getElementById("notification-bell"),R=document.getElementById("notification-dropdown"),v=document.getElementById("notification-count"),E=document.getElementById("notification-list"),X=document.getElementById("mark-all-read");let C=[],P=0,L=null;function A(t){R.style.display=t?"block":"none"}H.addEventListener("click",t=>{t.stopPropagation(),A(R.style.display!=="block")});document.addEventListener("click",t=>{!R.contains(t.target)&&t.target!==H&&A(!1)});async function x(){const{data:t}=await i.auth.getUser(),o=t?.user?.id;if(!o)return;const{data:d,error:c}=await i.from("notifications").select("*").eq("user_id",o).order("created_at",{ascending:!1}).limit(20);if(c){E.innerHTML="<em>Error loading notifications</em>",v.style.display="none";return}C=d||[],P=C.filter(s=>!s.read).length,$()}function $(){if(E.innerHTML="",!C.length){E.innerHTML="<em>No notifications</em>",v.style.display="none";return}C.forEach(t=>{const o=document.createElement("div");o.style.padding="0.5em 0.2em",o.style.borderBottom="1px solid #eee",o.style.background=t.read?"#f7f7f7":"#e6f7f2",o.style.cursor="pointer",o.innerHTML=`<span style="font-size:1.1em;">${t.icon||"ðŸ””"}</span> <span style="font-size:12pt;">${t.message}</span><br><span style="font-size:0.85em;color:#888;">${new Date(t.created_at).toLocaleString()}</span>`,t.read||(o.style.fontWeight="bold"),o.addEventListener("click",async()=>{t.read||(await ee(t.id),t.read=!0,$()),t.link&&(window.location.href=t.link)}),E.appendChild(o)}),P>0?(v.textContent=P,v.style.display="inline-block"):v.style.display="none"}async function ee(t){await i.from("notifications").update({read:!0}).eq("id",t),x()}X.addEventListener("click",async()=>{const{data:t}=await i.auth.getUser(),o=t?.user?.id;o&&(await i.from("notifications").update({read:!0}).eq("user_id",o),x())});function te(){x(),L&&clearInterval(L),L=setInterval(x,15e3)}te();async function oe(){try{let n=function(e){a[e]||(a[e]={votes:0,suggestions:0,comments:0,wants:0,offers:0,passion:0,projects:0,profile:0,circles_created:0,members_added:0,celebrations_posted:0,events_created:0,events_attended:0,help_hours:0,help_points:0,support_responses:0,writer_posts:0,writer_points:0,videos_posted:0,positive_impact:0,projects_proposed:0})};const[t,o,d,c,s,p,y,b,w,u,T,g,k,_,z,U,W]=await Promise.all([i.from("agreement_votes").select("voter_id"),i.from("suggestions").select("author_id"),i.from("comments").select("author_id"),i.from("member_offerings").select("user_id, want, give, passion"),i.from("contributions").select("user_id, project, challenge, help, collab, skills, urgency, contact"),i.from("profiles").select("id, full_name, avatar_url, personal_story"),i.from("circles").select("created_by"),i.from("circle_members").select("added_by"),i.from("celebrations").select("user_id"),i.from("events").select("created_by"),i.from("help_given").select("helper_id, hours"),i.from("support_responses").select("responder_id"),i.from("writers_wall").select("author_id, points"),i.from("member_video").select("user_id"),i.from("positive_impact").select("contributor_id, points_awarded"),i.from("event_attendance").select("user_id"),i.from("group_projects").select("proposer_id")]),l="81c50097-74f3-4c7a-b00c-598995b8d1cb",r={},a={};t.data?.forEach(e=>{e.voter_id!==l&&(n(e.voter_id),a[e.voter_id].votes+=1,r[e.voter_id]=(r[e.voter_id]||0)+1)}),o.data?.forEach(e=>{e.author_id!==l&&(n(e.author_id),a[e.author_id].suggestions+=1,r[e.author_id]=(r[e.author_id]||0)+1)}),d.data?.forEach(e=>{e.author_id!==l&&(n(e.author_id),a[e.author_id].comments+=1,r[e.author_id]=(r[e.author_id]||0)+1)}),c.data?.forEach(e=>{e.user_id!==l&&(n(e.user_id),e.want?.trim()&&(a[e.user_id].wants+=1,r[e.user_id]=(r[e.user_id]||0)+1),e.give?.trim()&&(a[e.user_id].offers+=1,r[e.user_id]=(r[e.user_id]||0)+1),e.passion?.trim()&&(a[e.user_id].passion+=1,r[e.user_id]=(r[e.user_id]||0)+1))}),s.data?.forEach(e=>{if(e.user_id!==l){n(e.user_id);let f=0;["project","challenge","help","collab","skills","urgency","contact"].forEach(h=>{e[h]?.trim()&&(f+=1)}),a[e.user_id].projects+=f,r[e.user_id]=(r[e.user_id]||0)+f}}),p.data?.forEach(e=>{if(e.id!==l){let f=0;e.full_name?.trim()&&f++,e.avatar_url?.trim()&&f++,f>=1&&(n(e.id),a[e.id].profile=1,r[e.id]=(r[e.id]||0)+5)}}),y.data?.forEach(e=>{e.created_by&&e.created_by!==l&&(n(e.created_by),a[e.created_by].circles_created+=1,r[e.created_by]=(r[e.created_by]||0)+10)}),b.data?.forEach(e=>{e.added_by&&e.added_by!==l&&(n(e.added_by),a[e.added_by].members_added+=1,r[e.added_by]=(r[e.added_by]||0)+2)}),w.data?.forEach(e=>{e.user_id&&e.user_id!==l&&(n(e.user_id),a[e.user_id].celebrations_posted+=1,r[e.user_id]=(r[e.user_id]||0)+5)}),u.data?.forEach(e=>{e.created_by&&e.created_by!==l&&(n(e.created_by),a[e.created_by].events_created+=1,r[e.created_by]=(r[e.created_by]||0)+5)}),U.data?.forEach(e=>{e.user_id&&e.user_id!==l&&(n(e.user_id),a[e.user_id].events_attended+=1,r[e.user_id]=(r[e.user_id]||0)+5)}),T.data?.forEach(e=>{e.helper_id&&e.hours&&e.helper_id!==l&&(n(e.helper_id),a[e.helper_id].help_hours+=Number(e.hours),a[e.helper_id].help_points+=e.hours*5,r[e.helper_id]=(r[e.helper_id]||0)+e.hours*5)}),g.data?.forEach(e=>{e.responder_id&&e.responder_id!==l&&(n(e.responder_id),a[e.responder_id].support_responses+=1,r[e.responder_id]=(r[e.responder_id]||0)+5)}),k.data?.forEach(e=>{e.author_id&&(n(e.author_id),a[e.author_id].writer_posts+=1,a[e.author_id].writer_points+=e.points||0,r[e.author_id]=(r[e.author_id]||0)+(e.points||0))}),_.data?.forEach(e=>{e.user_id&&e.user_id!==l&&(n(e.user_id),a[e.user_id].videos_posted=(a[e.user_id].videos_posted||0)+1,r[e.user_id]=(r[e.user_id]||0)+5)}),z.data?.forEach(e=>{e.contributor_id&&(n(e.contributor_id),a[e.contributor_id].positive_impact+=e.points_awarded,r[e.contributor_id]=(r[e.contributor_id]||0)+e.points_awarded)}),W.data?.forEach(e=>{e.proposer_id&&e.proposer_id!==l&&(n(e.proposer_id),a[e.proposer_id].projects_proposed+=1,r[e.proposer_id]=(r[e.proposer_id]||0)+5)});const M=Object.keys(r).filter(e=>e&&e!=="null");if(M.length>0){const e={};p.data?.forEach(m=>{e[m.id]=m});const f=M.map(m=>({id:m,profile:e[m]||{full_name:m,avatar_url:"",personal_story:""},total:r[m],breakdown:a[m]}));f.sort((m,O)=>O.total-m.total);const h=f[0],V=document.getElementById("most-active-member");V.innerHTML=`
                <a href="activities.html" style="text-decoration: none; color: inherit; display: block;">
                    <img src="${h.profile.avatar_url||"default-avatar.png"}" alt="Profile Picture" style="width:64px;height:64px;border-radius:50%;object-fit:cover;margin-bottom:1em;">
                    <h3>${h.profile.full_name||h.id}</h3>
                    <div class="activity-breakdown" style="margin-top:0.5em;">
                        <strong>All-Time Activities:</strong><br>
                        <strong>Total: ${h.total}</strong>
                    </div>
                </a>
                <div style="font-size:0.95em;color:#888;margin-bottom:0.5em;">
                    <strong>Activities Legend:</strong><br>
                    Votes, Suggestions, Comments, Wants, Offers, Passion, Projects & Struggles = 1 point each<br>
                    Events Created/Attended, Profile Completed, Circles Created, Members Added, Celebration Wall Posts, Support Responses = 5-10 points<br>
                    Help Given = 5 points/hour<br>
                    <span style="color:#4a7c59;font-weight:bold;">Writer's Post = 1 point per 1000 words</span>
                </div>`}}catch(t){console.error("Error fetching most active member:",t)}}async function re(){const t=new Date("2025-09-19T00:00:00Z"),{data:o}=await i.from("profiles").select("id, full_name, avatar_url, affirmation_text, affirmation_date").order("affirmation_date",{ascending:!1}),d=(o||[]).filter(s=>s.affirmation_date&&new Date(s.affirmation_date)>=t).sort((s,p)=>new Date(p.affirmation_date)-new Date(s.affirmation_date)).slice(0,3),c=document.getElementById("newest-member");if(c.innerHTML="",d.length===0){c.innerHTML="<em>No new member since 9/19/2025.</em>";return}for(const s of d){const{data:p}=await i.from("circle_members").select("circle_id").eq("user_id",s.id),{data:y}=await i.from("circles").select("id, name").eq("created_by",s.id);let b=[],w=[];if(y&&y.length>0)for(const g of y)w.push(g.name),b.push(g.name+" (creator)");if(p&&p.length>0){const g=p.map(_=>_.circle_id),{data:k}=await i.from("circles").select("id, name").in("id",g);if(k)for(const _ of k)!w.includes(_.name)&&!b.includes(_.name)&&b.push(_.name)}const u=document.createElement("a");u.href=`view-profile.html?id=${s.id}`,u.className="member-card",u.style.marginBottom="1em",u.style.textDecoration="none",u.style.color="inherit",u.style.display="block";const T=s.avatar_url&&s.avatar_url.trim()!==""?s.avatar_url:"public/default-avatar.png";u.innerHTML=`
            <img src="${T}" alt="Profile Picture" style="width:64px;height:64px;border-radius:50%;object-fit:cover;margin-bottom:0.5em;">
            <strong>${s.full_name||"Unnamed Member"}</strong>
            <div style="color:#888;">Joined: ${s.affirmation_date?new Date(s.affirmation_date).toLocaleDateString():"â€”"}</div>
            <div style="color:#555;">Circles: ${b.length?b.join(", "):"None"}</div>
        `,c.appendChild(u)}}document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector("#logout-button");t&&t.addEventListener("click",async()=>{const{error:o}=await i.auth.signOut();o?console.error("Error logging out:",o):window.location.href="login.html"})});async function ie(){const{data:t}=await i.auth.getUser(),o=t?.user?.id;if(!o)return;const d=localStorage.getItem(`lastReadCommunityChat_${o}`);if(!d){document.getElementById("community-chat-btn").innerHTML+=' <span style="background:red; color:white; padding:2px 6px; border-radius:4px; font-size:0.9em; font-weight:bold; position:relative; top:-2px;">new</span>';return}const{data:c}=await i.from("community_messages").select("created_at").order("created_at",{ascending:!1}).limit(1);c&&c[0]&&new Date(c[0].created_at)>new Date(d)&&(document.getElementById("community-chat-btn").innerHTML+=' <span style="background:red; color:white; padding:2px 6px; border-radius:4px; font-size:0.9em; font-weight:bold; position:relative; top:-2px;">new</span>')}async function ae(){const{data:t}=await i.auth.getUser(),o=t?.user?.id;if(!o)return;const{data:d}=await i.from("profiles").select("bio, personal_story, youtube, twitter, substack, facebook, instagram, linkedin, website").eq("id",o).single();(!d||!d.bio||d.bio.trim()==="")&&(document.getElementById("profile-btn").innerHTML+=' <span style="background:red; color:white; padding:2px 6px; border-radius:4px; font-size:0.9em; font-weight:bold; position:relative; top:-2px;">new</span>')}async function se(){const{data:t}=await i.auth.getUser(),o=t?.user?.id;if(!o)return;const d=localStorage.getItem(`lastReadSupportRequests_${o}`);if(!d){document.getElementById("view-support-btn").innerHTML+=' <span style="background:red; color:white; padding:2px 6px; border-radius:4px; font-size:0.9em; font-weight:bold; position:relative; top:-2px;">new</span>';return}const{data:c}=await i.from("support_requests").select("created_at").order("created_at",{ascending:!1}).limit(1);c&&c[0]&&new Date(c[0].created_at)>new Date(d)&&(document.getElementById("view-support-btn").innerHTML+=' <span style="background:red; color:white; padding:2px 6px; border-radius:4px; font-size:0.9em; font-weight:bold; position:relative; top:-2px;">new</span>')}oe();re();ie();ae();se();
