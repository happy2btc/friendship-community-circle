import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as c}from"./supabase-vDZkBp_j.js";const u=document.getElementById("profile-container"),h=new URLSearchParams(window.location.search),s=h.get("id");async function v(){if(!s){u.innerHTML="<div>No profile selected.</div>";return}const{data:r,error:g}=await c.from("profiles").select("full_name, avatar_url, bio, contact_info, show_contact").eq("id",s).single();if(g||!r){u.innerHTML="<div>Error loading profile.</div>";return}let i=r.avatar_url;i&&!i.startsWith("http")&&(i=`https://guykaykkefwabnuhqcyv.supabase.co/storage/v1/object/public/avatars/${i}`);const{data:d,error:y}=await c.from("profile_images").select("image_url").eq("user_id",s).limit(100);async function b(a){if(!a)return null;if(/^https?:\/\//i.test(a))return a;let n=a.replace(/^\/+/,""),o="profile-pictures",t=n;const l=n.split("/");l.length>1&&l[0]===o&&(l.shift(),t=l.join("/"));try{const{data:e,error:p}=c.storage.from(o).getPublicUrl(t);if(!p&&e&&e.publicUrl)return e.publicUrl}catch{}try{const{data:e,error:p}=await c.storage.from(o).createSignedUrl(t,3600);if(!p&&e&&e.signedUrl)return e.signedUrl}catch{}try{return`https://guykaykkefwabnuhqcyv.supabase.co/storage/v1/object/public/${o}/${encodeURIComponent(t)}`}catch{console.warn("Could not construct fallback URL for",a)}return console.warn("Could not resolve image path:",a),null}let f="";if(d&&d.length){const n=(await Promise.all(d.map(async o=>{const t=await b(o.image_url);return t?`<a href="${t}" target="_blank"><img src="${t}" style="width:100px;height:100px;object-fit:cover;border-radius:8px;box-shadow:0 2px 8px #eee;"></a>`:""}))).filter(Boolean).join("");n&&(f=`<h3 style="margin-top:2em;color:#4a7c59;">Gallery</h3><div style="display:flex;flex-wrap:wrap;justify-content:center;gap:16px;">${n}</div>`)}u.innerHTML=`
        <img class="profile-img" src="${i||"https://via.placeholder.com/120"}" alt="Profile Picture">
        <div class="profile-name">${r.full_name||"No Name"}</div>
        <div class="profile-bio">${r.bio||""}</div>
        <button id="chat-btn" class="menu-button" style="margin-top:1em;background:#2196f3;">ðŸ’¬ Chat with ${r.full_name||"this member"}</button>
        ${r.show_contact?`<div id="contact-block" style="margin-top:14px;text-align:left;border-top:1px solid #eee;padding-top:12px;"><h3 style="margin:0 0 6px 0;">Contact</h3><div style="white-space:pre-wrap;color:#222;background:rgba(255,255,255,0.9);padding:10px;border-radius:6px;">${r.contact_info||""}</div></div>`:""}
        ${f}
      `;const m=document.getElementById("chat-btn");m&&m.addEventListener("click",()=>{window.location.href=`personal-chat.html?user=${encodeURIComponent(s)}`})}v();
