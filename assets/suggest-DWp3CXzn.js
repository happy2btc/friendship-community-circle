import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as l}from"./supabase-vDZkBp_j.js";const o=document.getElementById("suggestion-form"),t=document.getElementById("status-message"),c=document.getElementById("submit-btn");let s;async function u(){const{data:{user:i}}=await l.auth.getUser();return i||(t.textContent="⚠️ You must be logged in to submit a suggestion.",t.style.color="red",o.style.display="none",null)}async function m(){if(s=await u(),!s)return;const i=document.getElementById("circle-select"),{data:n}=await l.from("circles").select("id, name");let r='<option value="public">Everyone (Public)</option>';n&&n.length>0&&n.forEach(e=>{r+=`<option value="${e.id}">${e.name}</option>`}),i.innerHTML=r}m();o.addEventListener("submit",async i=>{if(i.preventDefault(),c.disabled=!0,t.textContent="Submitting...",t.style.color="black",s=await u(),!s)return;const n=o.title.value.trim(),r=o.description.value.trim();let e=o["circle-select"].value;if(e==="public"&&(e=null),e&&e!==""){const{data:d}=await l.from("circle_members").select("id").eq("circle_id",e).eq("user_id",s.id).single();if(!d){t.textContent="You are not a member of the selected circle.",t.style.color="red",c.disabled=!1;return}}const{error:a}=await l.from("suggestions").insert([{title:n,description:r,author_id:s.id,status:"open",circle_id:e||null}]);if(a){t.textContent=`❌ Error: ${a.message}`,c.disabled=!1;return}t.textContent="✅ Suggestion submitted! Redirecting...",setTimeout(()=>{e?window.location.href=`discussions.html?circle_id=${e}`:window.location.href="discussions.html"},1200)});
