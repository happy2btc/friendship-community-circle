import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as m,_}from"./supabase-vDZkBp_j.js";const C=document.getElementById("auth-form"),r=document.getElementById("form-status"),h=document.getElementById("registration-fields"),f=document.getElementById("toggle-register-btn"),c=document.getElementById("submit-button"),w=document.getElementById("name");let l=!1;f.addEventListener("click",()=>{l=!l,l?(h.style.display="block",w.required=!0,c.textContent="Create Account",f.textContent="Login as Returning User"):(h.style.display="none",w.required=!1,c.textContent="Enter the Circle",f.textContent="Register as a New User"),r.textContent=""});C.addEventListener("submit",async u=>{u.preventDefault(),c.disabled=!0,r.textContent="Processing...",r.style.color="#333";const y=u.target,n=new FormData(y),d=n.get("email"),g=n.get("password");try{if(l){const e=n.get("name"),a=n.get("phone"),s=n.get("invited-by");let{data:o,error:p}=await m.auth.signUp({email:d,password:g,options:{data:{full_name:e,phone:a,invited_by:s}}});if(p)throw p;try{_(async()=>{const{supabaseUrl:t}=await import("./supabase-vDZkBp_j.js").then(i=>i.a);return{supabaseUrl:t}},[]).then(({supabaseUrl:t})=>{try{const b=`https://${new URL(t).host.split(".supabase.co")[0]}.functions.supabase.co/register-user`;fetch(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:o.user?.id,display_name:e||null,email:d||null,wallet_address:null})}).catch(E=>console.warn("register-user fallback failed (non-fatal):",E))}catch(i){console.warn("Could not compute functions URL for register-user fallback",i)}}).catch(t=>console.warn("Failed to import supabaseUrl for fallback",t))}catch(t){console.warn("register-user fallback exception:",t)}window.location.href="affirm.html"}else{let{data:e,error:a}=await m.auth.signInWithPassword({email:d,password:g});if(a)throw a;const{data:s,error:o}=await m.from("profiles").select("affirmation_text").eq("id",e.user.id).single();if(o&&o.code!=="PGRST116")throw o;s&&s.affirmation_text?window.location.href="main-menu.html":window.location.href="affirm.html"}}catch(e){r.textContent=`⚠️ Error: ${e.message}`,r.style.color="red"}finally{c.disabled=!1}});
