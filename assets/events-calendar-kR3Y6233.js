import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as c}from"./supabase-vDZkBp_j.js";async function x(){const{data:d,error:n}=await c.from("events").select("id, title, description, start_time, end_time, location, timezone, repeat, zoom_link");if(n)return console.error("Error loading events:",n),[];let t=[];return(d||[]).forEach(e=>{if(e.repeat&&e.repeat!=="none"){let r=new Date(e.start_time),a=e.end_time?new Date(e.end_time):null;for(let o=0;o<12;o++){let i=new Date(r),l=a?new Date(a):null;e.repeat==="daily"?(i.setDate(r.getDate()+o),l&&l.setDate(a.getDate()+o)):e.repeat==="weekly"?(i.setDate(r.getDate()+o*7),l&&l.setDate(a.getDate()+o*7)):e.repeat==="monthly"&&(i.setMonth(r.getMonth()+o),l&&l.setMonth(a.getMonth()+o)),t.push({id:e.id+"-"+o,title:e.title,start:i.toISOString(),end:l?l.toISOString():null,description:e.description,location:e.location,timezone:e.timezone,repeat:e.repeat,zoom_link:e.zoom_link,originalId:e.id})}}else t.push({id:e.id,title:e.title,start:e.start_time,end:e.end_time,description:e.description,location:e.location,timezone:e.timezone,repeat:e.repeat,zoom_link:e.zoom_link})}),t}let u;document.addEventListener("DOMContentLoaded",async function(){const d=document.getElementById("calendar"),n=await x();u=new FullCalendar.Calendar(d,{initialView:"dayGridMonth",events:n,eventClick:function(t){let e=`<strong>${t.event.title}</strong><br>`;t.event.extendedProps.description&&(e+=t.event.extendedProps.description+"<br>"),t.event.extendedProps.location&&(e+="<b>Location:</b> "+t.event.extendedProps.location+"<br>"),t.event.extendedProps.zoom_link&&(e+=`<b>Zoom:</b> <a href='${t.event.extendedProps.zoom_link}' target='_blank'>Join Meeting</a><br>`),e+=`<b>Start:</b> ${E(t.event.start,t.event.extendedProps.timezone)}<br>`,t.event.end&&(e+=`<b>End:</b> ${E(t.event.end,t.event.extendedProps.timezone)}<br>`),t.event.extendedProps.timezone&&(e+=`<b>Time Zone:</b> ${t.event.extendedProps.timezone}<br>`),t.event.extendedProps.repeat&&t.event.extendedProps.repeat!=="none"&&(e+=`<b>Repeats:</b> ${t.event.extendedProps.repeat}<br>`),e+="<button id='edit-event-btn' style='margin-top:1em;background:#4a7c59;color:#fff;padding:6px 14px;border-radius:6px;font-weight:bold;'>Edit</button>",B(e),document.getElementById("edit-event-btn").onclick=function(){document.getElementById("event-id").value=t.event.extendedProps.originalId||t.event.id,document.getElementById("event-title").value=t.event.title,document.getElementById("event-description").value=t.event.extendedProps.description||"",document.getElementById("event-location").value=t.event.extendedProps.location||"",document.getElementById("event-start").value=t.event.start.toISOString().slice(0,16),document.getElementById("event-end").value=t.event.end?t.event.end.toISOString().slice(0,16):"",document.getElementById("event-timezone").value=t.event.extendedProps.timezone||"UTC",document.getElementById("event-repeat").value=t.event.extendedProps.repeat||"none",document.getElementById("event-zoom").value=t.event.extendedProps.zoom_link||"",window.scrollTo({top:0,behavior:"smooth"})}}}),u.render()});function B(d){let n=document.getElementById("event-modal");n?(n.innerHTML=`<div style='background:#fff;padding:2em;border-radius:10px;max-width:400px;'>${d}<br><button id='close-modal-btn' style='margin-top:1em;background:#aaa;color:#fff;padding:6px 14px;border-radius:6px;font-weight:bold;'>Close</button></div>`,document.getElementById("close-modal-btn").onclick=function(){n.remove()}):(n=document.createElement("div"),n.id="event-modal",n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100vw",n.style.height="100vh",n.style.background="rgba(0,0,0,0.3)",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.zIndex="9999",n.innerHTML=`<div style='background:#fff;padding:2em;border-radius:10px;max-width:400px;'>${d}<br><button id='close-modal-btn' style='margin-top:1em;background:#aaa;color:#fff;padding:6px 14px;border-radius:6px;font-weight:bold;'>Close</button></div>`,document.body.appendChild(n),document.getElementById("close-modal-btn").onclick=function(){n.remove()})}function E(d,n){try{return new Date(d).toLocaleString("en-US",{timeZone:n||"UTC"})}catch{return new Date(d).toLocaleString()}}document.getElementById("event-form").addEventListener("submit",async function(d){d.preventDefault();const n=document.getElementById("event-status");n.textContent="";const t=document.getElementById("event-id").value,e=document.getElementById("event-title").value.trim(),r=document.getElementById("event-description").value.trim(),a=document.getElementById("event-location").value.trim(),o=document.getElementById("event-zoom").value.trim(),i=document.getElementById("event-start").value,l=document.getElementById("event-end").value,s=document.getElementById("event-timezone").value,p=document.getElementById("event-repeat").value,g=window.luxon.DateTime;let v=i?g.fromISO(i,{zone:s}).toUTC().toISO():null,y=l?g.fromISO(l,{zone:s}).toUTC().toISO():null;if(!e||!v){n.textContent="Title and start time are required.";return}const{data:{user:b}}=await c.auth.getUser(),I=b?b.id:null;let m;if(t?{error:m}=await c.from("events").update({title:e,description:r,location:a,zoom_link:o,start_time:v,end_time:y||null,timezone:s,repeat:p}).eq("id",t):{error:m}=await c.from("events").insert({title:e,description:r,location:a,zoom_link:o,start_time:v,end_time:y||null,timezone:s,repeat:p,created_by:I}),m)n.textContent="Error saving event: "+m.message;else{n.style.color="green",n.textContent=t?"Event updated!":"Event added!",document.getElementById("event-form").reset(),document.getElementById("event-id").value="";const f=await x();u.removeAllEvents(),u.addEventSource(f)}});document.getElementById("event-cancel").addEventListener("click",function(){document.getElementById("event-form").reset(),document.getElementById("event-id").value="",document.getElementById("event-status").textContent=""});
