import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as r}from"./supabase-vDZkBp_j.js";const g=document.getElementById("exchangeForm"),t=document.getElementById("confirmation"),f=g.querySelector("button");async function p(){const{data:{user:o}}=await r.auth.getUser();if(!o){t.textContent="⚠️ You must be logged in to use the Circle of Exchange.",t.style.color="red",g.style.display="none";return}document.getElementById("email").value=o.email;const{data:e,error:n}=await r.from("member_offerings").select("*").eq("user_id",o.id).single();n&&n.code!=="PGRST116"&&(console.error("Error fetching offering:",n),t.textContent="⚠️ Could not load your offering.",t.style.color="red"),e&&(document.getElementById("want").value=e.want||"",document.getElementById("give").value=e.give||"",document.getElementById("passion").value=e.passion||"",document.getElementById("visible").checked=e.visible)}g.addEventListener("submit",async function(o){o.preventDefault(),f.disabled=!0,t.textContent="Updating...",t.style.color="black";const{data:{user:e}}=await r.auth.getUser();if(console.log("User object:",e),console.log("User ID for upload:",e?e.id:"User is null"),!e){t.textContent="⚠️ Cannot submit: You are not logged in.",t.style.color="red";return}const n={user_id:e.id,want:document.getElementById("want").value,give:document.getElementById("give").value,passion:document.getElementById("passion").value,visible:document.getElementById("visible").checked},{error:a}=await r.from("member_offerings").upsert(n);a?(console.error("Submission failed:",error),t.textContent=`⚠️ Something went wrong: ${error.message}`,t.style.color="red"):(await v(e.id),t.textContent="✅ Your offering has been updated! Reloading...",setTimeout(()=>window.location.reload(),1500)),f.disabled=!1});const E=document.getElementById("offer-images"),y=document.getElementById("image-thumbnails");E?.addEventListener("change",o=>{y.innerHTML="";const e=Array.from(o.target.files);for(const n of e){const a=new FileReader;a.onload=s=>{const d=document.createElement("img");d.src=s.target.result,d.style.width="80px",d.style.margin="8px",y.appendChild(d)},a.readAsDataURL(n)}});async function v(o){const e=document.getElementById("offer-images"),n=document.getElementById("image-thumbnails"),a=Array.from(e.files);if(a.length===0)return;n.innerHTML="Processing images...";const{data:s,error:d}=await r.from("offer_images").select("id, image_url").eq("user_id",o);if(s&&s.length>0){const i=s.map(l=>l.image_url),c=s.map(l=>l.id);await r.storage.from("offer-images").remove(i),await r.from("offer_images").delete().in("id",c)}n.innerHTML="";let m=[];for(const i of a){const c=`offers/${o}/${Date.now()}_${i.name}`,{error:l}=await r.storage.from("offer-images").upload(c,i);if(l){m.push(`Error uploading ${i.name}: ${l.message}`);continue}const{error:u}=await r.from("offer_images").insert({user_id:o,image_url:c});if(u){m.push(`Error saving ${i.name} to database: ${u.message}`);continue}}m.length?t.innerHTML+=`<br><span style="color:red;">Image upload issues: ${m.join(", ")}</span>`:(t.textContent="✅ Offering and images saved successfully!",t.style.color="green",n.innerHTML="")}document.addEventListener("DOMContentLoaded",p);
